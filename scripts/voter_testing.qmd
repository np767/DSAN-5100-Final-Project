---
title: "Voter Turnout Hypothesis Testing"
format:
  html:
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Load Libraries and Data
```{r load-data}
library(tidyverse)

df <- read_csv("../data/processed-data/voter_turnout_selected_states.csv")

```


## One-Way ANOVA

**Hypotheses:**

- H0: Mean turnout is equal across all state categories
- H1: At least one group mean differs
- Significance level: α = 0.05
```{r anova}

anova_model <- aov(vep_turnout_rate ~ state_color, data = df)
anova_results <- summary(anova_model)
print(anova_results)


f_stat <- anova_results[[1]]["state_color", "F value"]
p_value_anova <- anova_results[[1]]["state_color", "Pr(>F)"]

cat("F-statistic:", round(f_stat, 4), "\n")
cat("p-value:", round(p_value_anova, 6), "\n")


if (p_value_anova < 0.05) {
    cat("Conclusion: REJECT H0 - Significant difference in mean turnout\n")
} else {
    cat("Conclusion: FAIL TO REJECT H0 - No significant difference\n")
}
```

---


## T-Test for Election Type

**Hypotheses:**

- H0: Mean turnout is equal for Presidential and Midterm elections
- H1: Mean turnout differs
- Significance level: α = 0.05

```{r ttest-election}
ttest_election <- t.test(vep_turnout_rate ~ election_type, data = df)

cat("Mean by Group:\n")
print(ttest_election$estimate)
cat("t-statistic:", round(ttest_election$statistic, 4), "| p-value:", round(ttest_election$p.value, 6), "\n")


if (ttest_election$p.value < 0.05) {
    cat("Conclusion: REJECT H0 - Significant difference in mean turnout\n")
} else {
    cat("Conclusion: FAIL TO REJECT H0 - No significant difference\n")
}
```

---

## Test 3: Chi-Square Tests

### Chi-Square 3a: Turnout Level (High/Low) vs Election Type
```{r chisq-election}
# Create turnout category
median_turnout <- median(df$vep_turnout_rate)
df <- df %>%
    mutate(turnout_category = ifelse(vep_turnout_rate >= median_turnout, "High", "Low"))


contingency_election <- table(df$election_type, df$turnout_category)
cat("Contingency Table:\n")
print(contingency_election)



chisq_election <- chisq.test(contingency_election)
cat("\nExpected Frequencies:\n")
print(round(chisq_election$expected, 2))



cat("\nStandardized Residuals (Positive > 2 means observed > expected significantly):\n")
print(round(chisq_election$stdres, 2))


cat("Chi-square:", round(chisq_election$statistic, 4), "| df:", chisq_election$parameter, "\n")
cat("p-value:", round(chisq_election$p.value, 6), "\n")
cat("Conclusion:", ifelse(chisq_election$p.value < 0.05, "NOT Independent", "Independent"), "\n")
```

### Chi-Square 3b: Turnout Level (High/Low) vs State Category
```{r chisq-turnout}
# Ensure turnout category exists
median_turnout <- median(df$vep_turnout_rate)
df <- df %>%
    mutate(turnout_category = ifelse(vep_turnout_rate >= median_turnout, "High", "Low"))

contingency_turnout <- table(df$turnout_category, df$state_color)
cat("Contingency Table:\n")
print(contingency_turnout)

chisq_turnout <- chisq.test(contingency_turnout)

cat("\nStandardized Residuals:\n")
print(round(chisq_turnout$stdres, 2))




cat("Chi-square:", round(chisq_turnout$statistic, 4), "| df:", chisq_turnout$parameter, "\n")
cat("p-value:", round(chisq_turnout$p.value, 6), "\n")
cat("Conclusion:", ifelse(chisq_turnout$p.value < 0.05, "NOT Independent", "Independent"), "\n")
```

---

## Summary Table
```{r summary-table}
summary_results <- tibble(
    Test = c(
        "ANOVA",
        "Election Type (T-Test)",
        "Election x Turnout", "Turnout x State"
    ),
    Statistic = c(
        paste0("F=", round(f_stat, 4)),
        paste0("t=", round(ttest_election$statistic, 4)),
        paste0("X2=", round(chisq_election$statistic, 4)),
        paste0("X2=", round(chisq_turnout$statistic, 4))
    ),
    p_value = round(c(
        p_value_anova,
        ttest_election$p.value, chisq_election$p.value, chisq_turnout$p.value
    ), 6),
    Decision = c(
        ifelse(p_value_anova < 0.05, "Sig", "Not Sig"),
        ifelse(ttest_election$p.value < 0.05, "Sig", "Not Sig"),
        ifelse(chisq_election$p.value < 0.05, "Dependent", "Independent"),
        ifelse(chisq_turnout$p.value < 0.05, "Dependent", "Independent")
    )
)

knitr::kable(summary_results, caption = "Summary of All Hypothesis Tests")
```
