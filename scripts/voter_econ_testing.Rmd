---
title: "Voter Turnout X Economic Metric Hypothesis Testing"
format:
  html:
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Load Libraries and Data
```{r load-data}
econ <- read.csv("../data/processed-data/merged_economic_data.csv")
voter <- read.csv("../data/processed-data/voter_turnout_selected_states.csv")

# Rename column to match

colnames(voter)[colnames(voter) == "state"] <- "State"

# Join datasets

econ_voter <- econ %>%
left_join(voter, by = c("year", "State")) %>%
select(-X) %>%
filter(!is.na(normalized_vep_turnout))  # keep only election years


econ_voter %>% mutate(econ_voter, normalized_vep_turnout=normalized_vep_turnout*100)
```

## Descriptive Statistics
```{r}
econ_metrics <- c("Household_Income", "Unemployment_Rate", "HPI")

summary_stats <- econ_voter %>%
select(all_of(econ_metrics), normalized_vep_turnout) %>%
summarise(across(everything(),
list(mean = ~mean(.x, na.rm = TRUE),
sd = ~sd(.x, na.rm = TRUE),
min = ~min(.x, na.rm = TRUE),
max = ~max(.x, na.rm = TRUE))))
knitr::kable(summary_stats, digits = 4, caption = "Descriptive Statistics for Economic Metrics and VEP Turnout")
```

---

## Test 1a: One-Way ANOVA (VEP Turnout by Income Group)

**Hypotheses:**

- **H0**: Mean VEP turnout is equal across the three income groups (low, mid, high).  
- **H1**: At least one income group has a different mean VEP turnout.  
- **Significance level**: α = 0.05
```{r}
# Categorize into tertiles

econ_voter <- econ_voter %>%
mutate(income_group = ntile(Household_Income, 3))  # 1 = low, 2 = mid, 3 = high

# Run ANOVA

anova_model_1 <- aov(normalized_vep_turnout ~ factor(income_group), data = econ_voter)
anova_results_1 <- summary(anova_model_1)
anova_results_1
```
## Test 1b: One-Way ANOVA (VEP Turnout by Unemployment Group)

**Hypotheses:**

- **H0**: Mean VEP turnout is equal across the three unemployment groups (low, mid, high).  
- **H1**: At least one unemployment group has a different mean VEP turnout.  
- **Significance level**: α = 0.05
```{r}
# Categorize into tertiles

econ_voter <- econ_voter %>%
mutate(unemployment_group = ntile(Unemployment_Rate, 3))  # 1 = low, 2 = mid, 3 = high

# Run ANOVA

anova_model_2 <- aov(normalized_vep_turnout ~ factor(unemployment_group), data = econ_voter)
anova_results_2 <- summary(anova_model_2)
anova_results_2
```
## Test 1c: One-Way ANOVA (VEP Turnout by HPI)

**Hypotheses:**

- **H0**: Mean VEP turnout is equal across the three HPI groups (low, mid, high).  
- **H1**: At least one HPI group has a different mean VEP turnout.  
- **Significance level**: α = 0.05
```{r}
# Categorize into tertiles

econ_voter <- econ_voter %>%
mutate(hpi_group = ntile(HPI, 3))  # 1 = low, 2 = mid, 3 = high

# Run ANOVA

anova_model_3 <- aov(normalized_vep_turnout ~ factor(hpi_group), data = econ_voter)
anova_results_3 <- summary(anova_model_3)
anova_results_3
```

---

## Test 2a: Independent Samples T-Tests (Pairwise Comparisons - Income Group)

Bonferroni-corrected significance level: α = 0.05 / 3 = 0.0167
```{r}
# Extract VEP turnout for each income group

low_income <- econ_voter %>% filter(income_group == 1) %>% pull(normalized_vep_turnout)
mid_income <- econ_voter %>% filter(income_group == 2) %>% pull(normalized_vep_turnout)
high_income <- econ_voter %>% filter(income_group == 3) %>% pull(normalized_vep_turnout)

# Bonferroni-corrected alpha

alpha_bonf <- 0.05 / 3

# Pairwise t-tests

ttest_low_mid <- t.test(low_income, mid_income, var.equal = FALSE)
ttest_low_high <- t.test(low_income, high_income, var.equal = FALSE)
ttest_mid_high <- t.test(mid_income, high_income, var.equal = FALSE)

# Print results neatly

t_test_results <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(ttest_low_mid$statistic, ttest_low_high$statistic, ttest_mid_high$statistic),
p_value = c(ttest_low_mid$p.value, ttest_low_high$p.value, ttest_mid_high$p.value),
Decision = c(ifelse(ttest_low_mid$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_low_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_mid_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"))
)

knitr::kable(t_test_results, digits = 4, caption = "Pairwise T-Tests with Bonferroni Correction")
```
## Test 2b: Independent Samples T-Tests (Pairwise Comparisons - Unemployment Group)

Bonferroni-corrected significance level: α = 0.05 / 3 = 0.0167
```{r}
# Extract VEP turnout for each income group

low_unemp <- econ_voter %>% filter(unemployment_group == 1) %>% pull(normalized_vep_turnout)
mid_unemp <- econ_voter %>% filter(unemployment_group == 2) %>% pull(normalized_vep_turnout)
high_unemp <- econ_voter %>% filter(unemployment_group == 3) %>% pull(normalized_vep_turnout)

# Bonferroni-corrected alpha

alpha_bonf <- 0.05 / 3

# Pairwise t-tests

ttest_low_mid <- t.test(low_unemp, mid_unemp, var.equal = FALSE)
ttest_low_high <- t.test(low_unemp, high_unemp, var.equal = FALSE)
ttest_mid_high <- t.test(mid_unemp, high_unemp, var.equal = FALSE)

# Print results neatly

t_test_results <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(ttest_low_mid$statistic, ttest_low_high$statistic, ttest_mid_high$statistic),
p_value = c(ttest_low_mid$p.value, ttest_low_high$p.value, ttest_mid_high$p.value),
Decision = c(ifelse(ttest_low_mid$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_low_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_mid_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"))
)

knitr::kable(t_test_results, digits = 4, caption = "Pairwise T-Tests with Bonferroni Correction")
```

## Test 2c: Independent Samples T-Tests (Pairwise Comparisons - HPI Group)

Bonferroni-corrected significance level: α = 0.05 / 3 = 0.0167
```{r}
# Extract VEP turnout for each income group

low_hpi <- econ_voter %>% filter(hpi_group == 1) %>% pull(normalized_vep_turnout)
mid_hpi <- econ_voter %>% filter(hpi_group == 2) %>% pull(normalized_vep_turnout)
high_hpi <- econ_voter %>% filter(hpi_group == 3) %>% pull(normalized_vep_turnout)

# Bonferroni-corrected alpha

alpha_bonf <- 0.05 / 3

# Pairwise t-tests

ttest_low_mid <- t.test(low_hpi, mid_hpi, var.equal = FALSE)
ttest_low_high <- t.test(low_hpi, high_hpi, var.equal = FALSE)
ttest_mid_high <- t.test(mid_hpi, high_hpi, var.equal = FALSE)

# Print results neatly

t_test_results <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(ttest_low_mid$statistic, ttest_low_high$statistic, ttest_mid_high$statistic),
p_value = c(ttest_low_mid$p.value, ttest_low_high$p.value, ttest_mid_high$p.value),
Decision = c(ifelse(ttest_low_mid$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_low_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(ttest_mid_high$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"))
)

knitr::kable(t_test_results, digits = 4, caption = "Pairwise T-Tests with Bonferroni Correction")
```

---

## Summary Table
```{r}
# Create a summary table for ANOVA and Pairwise T-Tests

summary_results <- tibble(
Test = c(
"ANOVA: Income Groups",
"Pairwise T-Tests: Income Groups",
"ANOVA: Unemployment Groups",
"Pairwise T-Tests: Unemployment Groups",
"ANOVA: HPI Groups",
"Pairwise T-Tests: HPI Groups"
),
Statistic = c(
paste0("F=", round(anova_results_1[[1]]["factor(income_group)", "F value"], 4)),
"See table above",
paste0("F=", round(anova_results_2[[1]]["factor(unemployment_group)", "F value"], 4)),
"See table above",
paste0("F=", round(anova_results_3[[1]]["factor(hpi_group)", "F value"], 4)),
"See table above"
),
p_value = c(
anova_results_1[[1]]["factor(income_group)", "Pr(>F)"],
"See table above",
anova_results_2[[1]]["factor(unemployment_group)", "Pr(>F)"],
"See table above",
anova_results_3[[1]]["factor(hpi_group)", "Pr(>F)"],
"See table above"
),
Decision = c(
ifelse(anova_results_1[[1]]["factor(income_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above",
ifelse(anova_results_2[[1]]["factor(unemployment_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above",
ifelse(anova_results_3[[1]]["factor(hpi_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above"
)
)

knitr::kable(summary_results, caption = "Summary of ANOVA and Pairwise T-Tests: Economic Metrics vs Normalized VEP Turnout")
```
