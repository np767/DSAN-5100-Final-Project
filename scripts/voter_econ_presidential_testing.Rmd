---
title: "Voter Turnout X Economic Metric Hypothesis Testing - Presidential Years"
format:
  html:
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Load Libraries and Data
```{r load-data}
econ <- read.csv("../data/processed-data/merged_economic_data.csv")
voter <- read.csv("../data/processed-data/voter_turnout_selected_states.csv")

# Rename column to match

colnames(voter)[colnames(voter) == "state"] <- "State"

# Join datasets

econ_voter <- econ %>%
left_join(voter, by = c("year", "State")) %>%
select(-X) %>%
filter(!is.na(normalized_vep_turnout))  # keep only election years


econ_voter %>% mutate(econ_voter, normalized_vep_turnout=normalized_vep_turnout*100)
econ_voter <- econ_voter %>% filter(election_type == "presidential")
```

## Descriptive Statistics
```{r}
econ_metrics <- c("Household_Income", "Unemployment_Rate", "HPI")

summary_stats <- econ_voter %>%
select(all_of(econ_metrics), normalized_vep_turnout) %>%
summarise(across(everything(),
list(mean = ~mean(.x, na.rm = TRUE),
sd = ~sd(.x, na.rm = TRUE),
min = ~min(.x, na.rm = TRUE),
max = ~max(.x, na.rm = TRUE))))
knitr::kable(summary_stats, digits = 4, caption = "Descriptive Statistics for Economic Metrics and VEP Turnout")
```

---

## Test 1a: One-Way ANOVA (VEP Turnout by Income Group)

```{r}
econ_voter <- econ_voter %>%
mutate(income_group = ntile(Household_Income, 3))

anova_model_1 <- aov(normalized_vep_turnout ~ factor(income_group), data = econ_voter)
anova_summary_1 <- summary(anova_model_1)
anova_summary_1
```

## Pairwise T-Tests for Income Groups

```{r}
alpha_bonf <- 0.05 / 3

low_income <- econ_voter %>% filter(income_group == 1) %>% pull(normalized_vep_turnout)
mid_income <- econ_voter %>% filter(income_group == 2) %>% pull(normalized_vep_turnout)
high_income <- econ_voter %>% filter(income_group == 3) %>% pull(normalized_vep_turnout)

tt_income <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(t.test(low_income, mid_income)$statistic,
t.test(low_income, high_income)$statistic,
t.test(mid_income, high_income)$statistic),
p_value = c(t.test(low_income, mid_income)$p.value,
t.test(low_income, high_income)$p.value,
t.test(mid_income, high_income)$p.value),
Decision = c(ifelse(t.test(low_income, mid_income)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(low_income, high_income)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(mid_income, high_income)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0")),
Mean_Diff = c(round(mean(low_income) - mean(mid_income),2),
round(mean(low_income) - mean(high_income),2),
round(mean(mid_income) - mean(high_income),2))
)

knitr::kable(tt_income, digits = 4, caption = "Pairwise T-Tests: Income Groups with Mean Differences")
```

## Test 1b: One-Way ANOVA (VEP Turnout by Unemployment Rate)

```{r}
econ_voter <- econ_voter %>%
mutate(unemployment_group = ntile(Unemployment_Rate, 3))

anova_model_2 <- aov(normalized_vep_turnout ~ factor(unemployment_group), data = econ_voter)
anova_summary_2 <- summary(anova_model_2)
anova_summary_2
```

## Pairwise T-Tests for Unemployment Groups

```{r}
low_unemp <- econ_voter %>% filter(unemployment_group == 1) %>% pull(normalized_vep_turnout)
mid_unemp <- econ_voter %>% filter(unemployment_group == 2) %>% pull(normalized_vep_turnout)
high_unemp <- econ_voter %>% filter(unemployment_group == 3) %>% pull(normalized_vep_turnout)

tt_unemp <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(t.test(low_unemp, mid_unemp)$statistic,
t.test(low_unemp, high_unemp)$statistic,
t.test(mid_unemp, high_unemp)$statistic),
p_value = c(t.test(low_unemp, mid_unemp)$p.value,
t.test(low_unemp, high_unemp)$p.value,
t.test(mid_unemp, high_unemp)$p.value),
Decision = c(ifelse(t.test(low_unemp, mid_unemp)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(low_unemp, high_unemp)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(mid_unemp, high_unemp)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0")),
Mean_Diff = c(round(mean(low_unemp) - mean(mid_unemp),2),
round(mean(low_unemp) - mean(high_unemp),2),
round(mean(mid_unemp) - mean(high_unemp),2))
)

knitr::kable(tt_unemp, digits = 4, caption = "Pairwise T-Tests: Unemployment Groups with Mean Differences")
```

## Test 1c: One-Way ANOVA (VEP Turnout by HPI)

```{r}
econ_voter <- econ_voter %>%
mutate(hpi_group = ntile(HPI, 3))

anova_model_3 <- aov(normalized_vep_turnout ~ factor(hpi_group), data = econ_voter)
anova_summary_3 <- summary(anova_model_3)
anova_summary_3
```

## Pairwise T-Tests for HPI Groups

```{r}
low_hpi <- econ_voter %>% filter(hpi_group == 1) %>% pull(normalized_vep_turnout)
mid_hpi <- econ_voter %>% filter(hpi_group == 2) %>% pull(normalized_vep_turnout)
high_hpi <- econ_voter %>% filter(hpi_group == 3) %>% pull(normalized_vep_turnout)

tt_hpi <- tibble(
Comparison = c("Low vs Mid", "Low vs High", "Mid vs High"),
t_statistic = c(t.test(low_hpi, mid_hpi)$statistic,
t.test(low_hpi, high_hpi)$statistic,
t.test(mid_hpi, high_hpi)$statistic),
p_value = c(t.test(low_hpi, mid_hpi)$p.value,
t.test(low_hpi, high_hpi)$p.value,
t.test(mid_hpi, high_hpi)$p.value),
Decision = c(ifelse(t.test(low_hpi, mid_hpi)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(low_hpi, high_hpi)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0"),
ifelse(t.test(mid_hpi, high_hpi)$p.value < alpha_bonf, "REJECT H0", "FAIL TO REJECT H0")),
Mean_Diff = c(round(mean(low_hpi) - mean(mid_hpi),2),
round(mean(low_hpi) - mean(high_hpi),2),
round(mean(mid_hpi) - mean(high_hpi),2))
)

knitr::kable(tt_hpi, digits = 4, caption = "Pairwise T-Tests: HPI Groups with Mean Differences")
```

## Summary Table

```{r}
summary_results <- tibble(
Test = c(
"ANOVA: Income Groups",
"Pairwise T-Tests: Income Groups",
"ANOVA: Unemployment Groups",
"Pairwise T-Tests: Unemployment Groups",
"ANOVA: HPI Groups",
"Pairwise T-Tests: HPI Groups"
),
Statistic = c(
paste0("F=", round(anova_summary_1[[1]]["factor(income_group)", "F value"], 4)),
"See table above",
paste0("F=", round(anova_summary_2[[1]]["factor(unemployment_group)", "F value"], 4)),
"See table above",
paste0("F=", round(anova_summary_3[[1]]["factor(hpi_group)", "F value"], 4)),
"See table above"
),
p_value = c(
anova_summary_1[[1]]["factor(income_group)", "Pr(>F)"],
"See table above",
anova_summary_2[[1]]["factor(unemployment_group)", "Pr(>F)"],
"See table above",
anova_summary_3[[1]]["factor(hpi_group)", "Pr(>F)"],
"See table above"
),
Decision = c(
ifelse(anova_summary_1[[1]]["factor(income_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above",
ifelse(anova_summary_2[[1]]["factor(unemployment_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above",
ifelse(anova_summary_3[[1]]["factor(hpi_group)", "Pr(>F)"] < 0.05, "Sig", "Not Sig"),
"See table above"
)
)

knitr::kable(summary_results, caption = "Summary of ANOVA and Pairwise T-Tests: Economic Metrics vs Normalized VEP Turnout")
```
